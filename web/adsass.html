<HTML>

<head>
    <meta charset="utf-8" />

    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="layout.css">

    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script src="http://www.worldwidetelescope.org/scripts/wwtsdk.aspx"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js">
    </script>

    <title>ADS All-Sky survey on WorldWide Telescope</title>

    <style>
    #slider .ui-slider-handle {
        background: #ef2929;
    }
    </style>

</head>

<body onload="initialize()">
    <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">The ADS All Sky Survey</a>

        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                <li>
                    <a href="about.html">
                        <span class="glyphicon glyphicon-bullhorn"></span>About</a>
                </li>
                <li>
                    <a href="videos.html">
                        <span class="glyphicon glyphicon-play"></span>Watch video tutorials</a>
                </li>

                <li>
                    <a href="http://adsass.org" target="_blank" class="">
                        <span class="glyphicon glyphicon-new-window"></span>Open Aladin version</a>
                </li>
            </ul>

            <p class="navbar-text pull-right">Astronomy articles. In the sky.</p>
        </div>
        <!-- /.navbar-collapse -->
    </nav>

    <div class="container">

        <div class="well">
            <button type="button" class="btn btn-danger pull-right" style="margin:0 10 0 10" id="button-source">
                Show Sources
            </button>

            <div class="well-title">CHOOSE HEATMAP</div>

            <div class="facets">

                <span id="facet-list">
                    <span class="label label-info">Object</span>
                    <a href="allSources_512" class="label label-default">All</a>&nbsp;
                    <a href="Star_512">Stars</a>&nbsp;
                    <a href="Galaxy_512">Galaxies</a>&nbsp;
                    <a href="HII-region_512">HII regions</a>&nbsp;
                    <a href="Nebula_512">Nebulae</a>&nbsp;
                    <a href="Other_512">Other</a>&nbsp;&nbsp;&nbsp;&nbsp;
                    <br>
                    <span class="label label-info">Band</span>
                    <a href="Radio_512">Radio</a>&nbsp;
                    <a href="Infrared_512">Infrared</a>&nbsp;
                    <a href="UV_512">Ultraviolet</a>&nbsp;
                    <a href="X_512">X-ray</a>&nbsp;&nbsp;&nbsp;&nbsp;
                    <br>
                    <span class="label label-info">Custom</span>
                    <a href="Harvard v All">Harvard/CfA</a>&nbsp;&nbsp;&nbsp;&nbsp;
                </span>
                <br>
                <span class="label label-info">Year</span>
                <div style="margin-left:14px; display: inline-block;" id="slider-year" class="ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" aria-disabled="false">
                    <div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-max" style="width: 100%;"></div>
                    <a class="ui-slider-handle ui-state-default ui-corner-all" href="#" style="left: 0%;"></a>
                </div>
                <span type="text" id="year-label" class="active" style="margin-left: 8px;   font-weight: bold; color: #ffffff;background-color: #b6b6b6;padding: 2px;border: 1px dashed darkgray;border-radius: 5px; width: 40px;"></span>

            </div>

            <div style="margin-top:10px" class="well-title">BACKGROUND LAYER</div>
            <span id="base-list">
                <span id="toggle-list">
                    <a href="Digitized Sky Survey (Color)"> Optical </a> &nbsp;
                    <a href="2MASS: Catalog (Synthetic, Near Infrared)"> 2MASS </a> &nbsp;
                    <a href="WISE All Sky (Infrared)" class="label label-default"> WISE </a>
                    &nbsp;
                    <a href="SFD Dust Map (Infrared)"> SFD </a>
                    &nbsp;
                    <a href="IRIS: Improved Reprocessing of IRAS Survey (Infrared)"> IRIS </a>
                    &nbsp;
                    <a href="GLIMPSE/MIPSGAL"> GLIMPSE </a>
                    &nbsp;
                    <a href="Hydrogen Alpha Full Sky Map"> H-alpha </a>
                    &nbsp;
                    <a href="RASS: ROSAT All Sky Survey (X-ray)"> ROSAT  </a>
                    &nbsp;
                    <a href="Fermi (Gamma)"> Fermi </a>
                    &nbsp;
                    <a href="VLSS: VLA Low-frequency Sky Survey (Radio)"> VLSS </a>
                    &nbsp;
                </span>
            </span>
            <br>
            <div style="margin-left:10px; margin-top:10px; display: inline-block;" id="slider-opacity" class="ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all">
                <div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-max" style="width: 100%;"></div>
                <a class="ui-slider-handle ui-state-default ui-corner-all" href="#" style="left: 0%;"></a>
            </div>
        </div>

        <div class="row">
            <div class="span12">
                <div id="WorldWideTelescopeControlHost">
                    <div id="WWTCanvas" style="width: 1198; height: 518px; border-style: none; border-width: 0px;">
                    </div>
                </div>
                <span id="sky-location"></span>
            </div>
        </div>
        <br>
    </div>

    <div class="modal fade" id="finderscope" tabindex="-1" role="dialog" aria-labelledby="finderscope-label" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="finderscope-label"></h4>
                </div>
                <div class="modal-body">
                    test
                </div>
            </div>
        </div>
    </div>

    <div id="footer">
        <div class="container">
            <center>
                <h4>ADS All-Sky Survey is a NASA-funded project</h4>
                <p class="text-muted credit" style="max-width:700px">The ADSASS is a collaboration of the Harvard-Smithsonian Center for Astrophysics, Harvard University, the Strasbourg astronomical Data Center (CDS), and Microsoft Research.</p> <a href="http://projects.iq.harvard.edu/seamlessastronomy/">Seamless Astronomy</a>&nbsp;·&nbsp;<a href="http://adslabs.org">ADS Labs</a>&nbsp;·&nbsp;<a href="http://cdsweb.u-strasbg.fr/">CDS</a>
            </center>
        </div>
    </div>
</body>

<script type="text/javascript">
var wwt;

var years = ["date-pre1800_512", "date-1800_1850_512", "date-1850_1900_512", "date-1900_1910_512",
    "date-1910_1920_512", "date-1920_1930_512", "date-1930_1940_512", "date-1940_1945_512", "date-1945_1950_512",
    "date-1950_1955_512", "date-1955_1960_512", "date-1960_1965_512", "date-1965_1970_512", "date-1970_1975_512",
    "date-1975_1980_512", "date-1980_1985_512", "date-1985_1990_512", "date-1990_512", "date-1991_512",
    "date-1992_512", "date-1993_512", "date-1994_512", "date-1995_512", "date-1996_512", "date-1997_512",
    "date-1998_512", "date-1999_512", "date-2000_512", "date-2001_512", "date-2002_512", "date-2003_512",
    "date-2004_512", "date-2005_512", "date-2006_512", "date-2007_512", "date-2008_512", "date-2009_512",
    "date-2010_512", "date-2011_512", "date-2012_512", "date-2013_512"
];
var cat = [];
var cat_color = '#ff0000';
var cat_radius = 5;
var cat_visible = false;

function initialize() {
    wwt = wwtlib.WWTControl.initControl("WWTCanvas");
    wwt.add_ready(wwtReady);
}

function displayCoordinates(event) {
    var coords = '(α,δ)=' + wwt.getRA().toFixed(2) + ", " + wwt.getDec().toFixed(2) + " FOV= " + wwt.get_fov().toFixed(0) + "°";
    $('#sky-location').text(coords);
}

function finderScope(parent, obj) {
    var simbad_url = 'http://simbad.u-strasbg.fr/simbad/sim-id?Ident=' + encodeURIComponent(obj.id);

    var url = 'http://simbad.harvard.edu/simbad/sim-script';
    var script = 'output script=off\noutput console=off\noutput error=off\nformat object f1 "%BIBCODELIST(R;;1000;%B | %1A | %J)"'
    script += '\nquery ' + obj.id

    $.ajax({
        url: url,
        type: "POST",
        data: {
            'submit': 'submit script',
            'script': script
        },
        success: function(data) {
            var output = '<h4> Papers </h4>';
            uresult = data.split(/\r?\n/);
            //uresult = unique(result);
            var biblist = [];
            truncated = false;

            //trim list of papers to 120 to avoid URL too long to fail
            if (uresult.length > 201) {
                truncated = true;
                paper_length = 201;
            } else {
                paper_length = uresult.length;
                truncated = false;
            }

            if (truncated) {
                output += "<p class='small text-danger'>Note: List truncated to 200 papers</p>"
            }


            for (var i = 0; i < paper_length; i++) {
                if ( !! uresult[i]) {
                    output += '<a target="_blank" href="http://adsabs.harvard.edu/abs/' + encodeURIComponent(uresult[i].split('|')[0]) + '">' + uresult[i].split('|')[1].trim() + ' ' + uresult[i].split('|')[2].trim() + '</a><br>';
                    biblist.push(encodeURIComponent(uresult[i].split('|')[0]))
                }
            }

            biblist = biblist + "";
            biblist = biblist.replace(/\,/g, 'OR%20');
            biblist = 'http://labs.adsabs.harvard.edu/ui/cgi-bin/topicSearch?q=bibcode:(' + biblist + ')'

            buttons = "<a class='btn btn-default' type='button' target='_blank' href='" + simbad_url + "'> SIMBAD Entry </a>"
            buttons += '&nbsp; <a class="btn btn-default" type="button" target="_blank" href="' + biblist + '"> Open papers in ADS </a>'

            $('#finderscope-label').html(obj.id + " " + buttons);
            $('#finderscope .modal-body').html(output);
            $("#finderscope").modal('show');
        }
    });
}

function wwtReady() {
    wwt.settings.set_showCrosshairs(true);
    wwt.settings.set_showConstellationFigures(false);
    wwt.hideUI(true);
    wwt.settings.set_showConstellationBoundries(false);
    // Load in the image collection file
    wwt.loadImageCollection("/adsass.wtml");

    wwt.add_collectionLoaded(default_layers);
    wwt.add_annotationClicked(finderScope);

    $("#WWTCanvas").mousemove(displayCoordinates);
    $("#WWTCanvas").scroll(function(e) {
        e.preventDefault()
    });

    $.getJSON('simbad.json', function(data) {
        for (var i = 0; i < data.length; i++) {
            var circle = wwt.createCircle(true);
            circle.set_lineColor(cat_color);
            circle.set_fillColor(cat_color);
            circle.set_lineWidth(0);
            circle.set_opacity(0.8);
            circle.set_radius(cat_radius);
            circle.setCenter(data[i]['ra'], data[i]['dec']);
            circle.set_label(data[i]['name']);
            circle.set_id(data[i]['name']);
            circle.set_showHoverLabel(true);
            cat.push(circle);
        }
    });

    $('#WWTCanvas').mouseout(function(e) {
        wwtlib.WWTControl.singleton.onMouseUp(e)
    });

}

function showCatalog() {
    cat_visible = true;
    for (var i = 0; i < cat.length; i++) wwt.addAnnotation(cat[i]);
}

function hideCatalog() {
    cat_visible = false;
    wwt.clearAnnotations();
}

function toggleCatalog() {
    if (cat_visible) {
        hideCatalog();
    } else {
        showCatalog();
    }
}

function default_layers() {
    console.log("Set layer");
    wwt.setBackgroundImageByName("WISE");
    wwt.setForegroundImageByName("allSources_512");
    wwt.setForegroundOpacity(50);
}

function setForeground(layer) {
    console.log("Set heatmap to", layer);
    wwt.setForegroundImageByName(layer);
    wwt.setForegroundOpacity($("#slider-opacity").slider("option", "value"));
}

function deslectFacets() {
    //update highlight
    $("#facet-list a").each(function(index) {
        $(this).attr('class', '');
    });
    $("#year-label").hide();
}

$(function() {
    $("#year-label").hide();

    $("#slider-opacity").slider({
        min: 0,
        max: 100,
        value: 50,
        slide: function(event, ui) {
            wwt.setForegroundOpacity(ui.value);
        }
    });

    $("#toggle-list a").click(function(e) {
        e.preventDefault();
        var url = $(this).attr('href');
        wwt.setBackgroundImageByName(url);

        //update highlight
        $("#toggle-list a").each(function(index) {
            $(this).attr('class', '');
        });
        $(this).attr('class', 'label label-default');
    });

    $("#facet-list a").click(function(e) {
        e.preventDefault();
        var url = $(this).attr('href');
        setForeground(url);
        deslectFacets();
        $(this).attr('class', 'label label-default');
    });

    $("#slider-year").slider({
        min: 0,
        max: years.length - 1,
        value: years.length / 2,
        slide: function(event, ui) {
            var layer = years[ui.value];
            var display = layer.slice(5, layer.length - 4);

            deslectFacets();
            setForeground(layer);
            $("#year-label").show().text(display);
        }
    });
    $("#button-source").click(toggleCatalog);

    $('#WWTCanvas').bind('mousewheel DOMMouseScroll', function(e) {
        e.preventDefault();
    });
})
</script>

</HTML>